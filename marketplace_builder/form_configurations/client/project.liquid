---
name: project
base_form: TransactableForm
configuration:
  name:
    validation: { presence: true }
  description:
    validation:
      presence: true
  properties:
    deadline:
      validation:
        presence: true
    workplace_onsite:
      validation: {}
    workplace_online:
      validation: {}
    budget:
      validation:
        presence: true
  offer_action:
    pricings:
      enabled: {}
      validation:
        length:
          minimum: 1
        if: :enabled?
    validation:
      presence: true
---
{% assign form_url = "/api/user/transactables/" | append: form.id %}
{% if form.id == blank %}
  {% assign http_method = 'post' %}
{% else %}
  {% assign http_method = 'put' %}
{% endif %}

{% form_for form, url: @form_url, as: form, method: @http_method %}
  <input value="{{ form_configuration.id }}" type="hidden" name="form_configuration_id" />
  <input value="{{ page.id }}" type="hidden" name="page_id" />
  <input value="{{ form.model.transactable_type.id }}" type="hidden" name="transactable_type_id" />
  <input value="/" type="hidden" name="return_to" />

  {% input name %}
  {% input description, as: text %}

  {% fields_for properties %}
    {% input workplace_online, as: boolean, form: properties %}
    {% input workplace_onsite, as: boolean, form: properties %}
    {% input budget, form: properties %}
    {% input deadline, form: properties, placeholder: 'YYYY-mm-dd' %}
  {% endfields_for %}

  {% fields_for offer_action %}
    {% input_field enabled, as: hidden, value: 1, form: offer_action %}
    {% fields_for pricings, form: offer_action %}
      {% input_field enabled, as: hidden, value: 1, form: pricings %}
      {% input_field transactable_type_pricing_id, as: hidden, form: pricings %}
      {% input_field price, as: hidden, form: pricings %}
    {% endfields_for %}
  {% endfields_for %}

  {% submit Save %}
{% endform_for %}
